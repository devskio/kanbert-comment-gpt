(()=>{"use strict";var e={4:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Kanbert=void 0;const i=r(n(913)),a="kanbert-chatgpt-btn";t.Kanbert=class{constructor(){this.appendStyles(),this.initHandler(),this.observe()}appendStyles(){document.head.insertAdjacentHTML("beforeend",'<style>\n            #kanbert-chatgpt-btn {\n              width: 20px;\n              height: 20px;\n              cursor: pointer;\n              border: none;\n              background: none;\n              padding: 0;\n              margin: 0;\n              outline: none;\n              position: absolute;\n              top: 7px;\n              right: 7px; \n            }\n            \n            #kanbert-chatgpt-btn:disabled, #kanbert-chatgpt-btn[disabled="true"] {\n              opacity: 0.3 !important;\n              cursor: not-allowed;\n            }\n            \n            #kanbert-chatgpt-btn[loading="true"] {\n              animation: kanbert-chatgpt-animation-rotation 2s infinite linear;\n            }\n       \n            #kanbert-chatgpt-btn svg {\n              width: 20px;\n              height: 20px;\n            }\n            \n            @keyframes kanbert-chatgpt-animation-rotation {\n              from {\n                transform: rotate(0deg);\n              }\n              to {\n                transform: rotate(359deg);\n              }\n            }\n        </style>')}fetchComment(e=""){return o(this,void 0,void 0,(function*(){const t=yield(0,i.default)(),n={model:"gpt-3.5-turbo-1106",messages:this.generateMessages(t["kanbert-comment-full-name"],e),temperature:.4,max_tokens:3e3};console.log(n.messages.reduce(((e,t)=>e+t.content+"\n\n"),""));try{const e=yield fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t["kanbert-comment-openapi-key"]}`},body:JSON.stringify(n)}),o=yield e.json();if(!e.ok)throw new Error(o.error.message);return Promise.resolve(o.choices[0].message.content||"No response from ChatGPT.")}catch(e){return Promise.resolve(`An error occurred while fetching data from ChatGPT. ${e.message}`)}}))}generateMessages(e="",t=""){var n,o;const r=[];let i=null===(n=document.querySelector('[class^="FieldUpdate__TaskDescriptionFooter"]'))||void 0===n?void 0:n.textContent,a=[];document.querySelectorAll('[class^="Item__CommentWrapper"]').forEach((t=>{var n;let o="";const r=t.querySelector('[class^="Item__CommentNameStyled"]');r&&(o=[].reduce.call(r.childNodes,(function(e,t){return e+(3===t.nodeType?t.textContent:"")}),""));const s=null===(n=t.querySelector('[class*=" Item__CommentTextStyled"]'))||void 0===n?void 0:n.textContent;o&&s&&(a.push(`${o} wrote: ${s}`),o!==e&&(i=o))}));let s=`You are ${e}, a web developer with a very good web development expertise.`;if(r.push({role:"system",content:s}),r.push({role:"user",content:"Please read the given task description and all the comments related to it to understand the context."}),r.push({role:"user",content:"Task Description:"+(null===(o=document.querySelector('[class*="FieldUpdate__CommentTextStyled"]'))||void 0===o?void 0:o.textContent)}),a.length>0){let e=r[0].content.length+r[1].content.length+t.length,n="";a.reverse().forEach((t=>{e+t.length<4e4&&(n=t+"\n\n"+n,e+=t.length)})),n="Comments:\n\n"+n,r.push({role:"user",content:n})}let l=`Respond to the last comment from ${i} in a short, friendly and simple English, providing relevant information or assistance.`;return t&&(l+=` Use following input as base for your reply: ${t}`),r.push({role:"user",content:l}),r}initHandler(){document.body.addEventListener("click",(e=>o(this,void 0,void 0,(function*(){var t;const n=e.target,o=null==n?void 0:n.closest(`#${a}`);if(!o)return;const r=null===(t=null==o?void 0:o.closest('[class^="Activity__TasksDetailActivityWrapper"]'))||void 0===t?void 0:t.querySelector('[class="DraftEditor-root"]');if(!r)return;o.setAttribute("disabled","true"),o.setAttribute("loading","true");const i=yield this.fetchComment(r.textContent||"");i.length?yield this.setEditorText(r,i):yield this.setEditorText(r,"ChatGPT failed."),o.removeAttribute("disabled"),o.removeAttribute("loading")}))))}inject(e){"true"!==e.getAttribute("hasChatGPT")&&(e.setAttribute("hasChatGPT","true"),null==e||e.insertAdjacentHTML("beforeend",`<button id="${a}" role="button">\n                        <svg width="20" height="20" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M119.592 52.3793C121.043 48.0693 121.545 43.5036 121.064 38.987C120.583 34.4705 119.131 30.1071 116.804 26.1884C109.726 14.0353 95.5002 7.78387 81.6066 10.7214C77.7597 6.50049 72.8547 3.35231 67.384 1.59305C61.9133 -0.166198 56.0697 -0.474584 50.44 0.698867C44.8103 1.87232 39.5927 4.48629 35.3112 8.27827C31.0297 12.0702 27.835 16.9067 26.0481 22.302C21.537 23.2144 17.2752 25.0662 13.5477 27.7335C9.82019 30.4008 6.71276 33.8222 4.4331 37.769C-2.7219 49.9029 -1.0974 65.2081 8.44961 75.6178C6.99332 79.9257 6.48643 84.4906 6.96284 89.0073C7.43925 93.524 8.88798 97.8883 11.2121 101.808C18.2991 113.966 32.5341 120.217 46.4351 117.275C49.4915 120.67 53.2468 123.383 57.4505 125.232C61.6542 127.081 66.2094 128.025 70.8121 128C85.0527 128.012 97.6692 118.944 102.019 105.568C106.53 104.654 110.791 102.801 114.518 100.134C118.245 97.4671 121.353 94.0466 123.634 90.1009C130.702 77.9887 129.071 62.7663 119.592 52.3793ZM70.8121 119.622C65.1279 119.631 59.622 117.666 55.2596 114.071L56.0271 113.642L81.8621 98.9323C82.5052 98.5603 83.039 98.0297 83.4113 97.3927C83.7836 96.7557 83.9816 96.0341 83.9856 95.2988V59.3685L94.9081 65.6007C95.0171 65.6555 95.0932 65.7586 95.1127 65.8784V95.6519C95.0847 108.879 84.2211 119.595 70.8121 119.622ZM18.5791 97.6203C15.7285 92.7649 14.7049 87.0735 15.6886 81.5471L16.4556 82.0014L42.3166 96.7118C42.9565 97.0822 43.685 97.2775 44.4269 97.2775C45.1688 97.2775 45.8973 97.0822 46.5371 96.7118L78.1276 78.7467V91.1859C78.1247 91.2503 78.1071 91.3133 78.0761 91.3701C78.0451 91.4269 78.0016 91.476 77.9486 91.5139L51.7811 106.401C40.1526 113.009 25.2961 109.08 18.5791 97.6203ZM11.7746 42.1092C14.645 37.2226 19.1758 33.4954 24.5646 31.5876V61.8657C24.5549 62.5972 24.7444 63.318 25.1133 63.9527C25.4823 64.5873 26.0171 65.1127 26.6621 65.474L58.0991 83.3636L47.1766 89.5958C47.1176 89.6267 47.0517 89.6428 46.9849 89.6428C46.918 89.6428 46.8522 89.6267 46.7931 89.5958L20.6766 74.735C9.07111 68.0993 5.0911 53.456 11.7746 41.9834V42.1092ZM101.508 62.6735L69.9676 44.6073L80.8651 38.4003C80.9243 38.3693 80.9902 38.3531 81.0571 38.3531C81.1241 38.3531 81.19 38.3693 81.2491 38.4003L107.366 53.2873C111.359 55.5601 114.614 58.9065 116.752 62.9359C118.889 66.9652 119.82 71.5112 119.437 76.0431C119.053 80.575 117.371 84.9058 114.586 88.5297C111.8 92.1537 108.028 94.9214 103.708 96.5096V66.231C103.685 65.5008 103.47 64.789 103.085 64.1653C102.699 63.5416 102.156 63.0275 101.508 62.6735ZM112.379 46.5506L111.611 46.0958L85.8017 31.2596C85.1579 30.887 84.425 30.6906 83.6786 30.6906C82.9323 30.6906 82.1994 30.887 81.5556 31.2596L49.9901 49.2252V36.786C49.9834 36.7228 49.9941 36.6589 50.0211 36.6012C50.0482 36.5435 50.0905 36.494 50.1436 36.458L76.2601 21.5962C80.2628 19.3216 84.8393 18.2183 89.4544 18.4152C94.0694 18.6121 98.5322 20.1012 102.321 22.7082C106.109 25.3152 109.067 28.9323 110.848 33.1366C112.629 37.3409 113.16 41.9586 112.378 46.4494L112.379 46.5506ZM44.0306 68.6029L33.1081 62.3959C33.0535 62.3633 33.0069 62.3193 32.9714 62.267C32.936 62.2146 32.9127 62.1553 32.9031 62.093V32.3955C32.9092 27.8396 34.2299 23.3797 36.7109 19.537C39.1919 15.6943 42.7307 12.6277 46.9134 10.6957C51.0961 8.76378 55.75 8.04632 60.3309 8.62722C64.9117 9.20812 69.2303 11.0634 72.7816 13.9761L72.0141 14.4052L46.1791 29.1151C45.5362 29.4872 45.0024 30.0177 44.6302 30.6548C44.258 31.2918 44.0602 32.0134 44.0561 32.7486L44.0306 68.6029ZM49.9646 55.9866L64.0336 47.9883L78.1276 55.9871V71.9838L64.0846 79.9827L49.9906 71.9838L49.9646 55.9866Z" fill="#75ab9e"/>\n                        </svg>\n                </button>`))}observe(){new MutationObserver((e=>{const t=document.querySelector('[class^="Activity__TasksDetailActivityWrapper"] [class^="Editor__ToolbarWrapper"],[class*=" Activity__TasksDetailActivityWrapper"] [class^="Editor__ToolbarWrapper"]');t&&this.inject(t)})).observe(document.body,{childList:!0,subtree:!0})}setEditorText(e,t){var n;return o(this,void 0,void 0,(function*(){const o=new DataTransfer,r=null==e?void 0:e.querySelector("[contenteditable]");null==r||r.addEventListener("selectAll",(()=>{document.execCommand("selectAll")})),(null===(n=null==r?void 0:r.textContent)||void 0===n?void 0:n.length)&&(null==r||r.click(),r.dispatchEvent(new CustomEvent("selectAll")),yield new Promise((e=>setTimeout(e,500)))),o.setData("text/plain",t),null==r||r.dispatchEvent(new ClipboardEvent("paste",{bubbles:!0,clipboardData:o,cancelable:!0}))}))}}},913:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CONFIG=void 0;const n=["kanbert-comment-openapi-key","kanbert-comment-full-name"];t.DEFAULT_CONFIG={"kanbert-comment-openapi-key":"","kanbert-comment-full-name":""},t.default=()=>new Promise(((e,o)=>{var r,i;return null===(i=null===(r=null===chrome||void 0===chrome?void 0:chrome.storage)||void 0===r?void 0:r.local)||void 0===i?void 0:i.get(n,(n=>{const o=Object.keys(t.DEFAULT_CONFIG).reduce(((e,o)=>Object.assign(Object.assign({},e),{[o]:(null==n?void 0:n[o])||t.DEFAULT_CONFIG[o]})),{});e(o)}))}))}},t={};new(function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(4).Kanbert)})();